<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mini ERP con Firebase</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f9f9f9; }
    h2 { color: #333; }
    .section { background:#fff; padding:15px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    table { width:100%; border-collapse: collapse; margin-top:10px; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:8px; text-align:left; }
    button { margin:3px; padding:6px 12px; border:none; border-radius:5px; cursor:pointer; }
    .btn { background:#1976d2; color:#fff; }
    .btn-danger { background:#d32f2f; color:#fff; }
    .btn-secondary { background:#388e3c; color:#fff; }
  </style>
</head>
<body>
<div class="container">

  <!-- CLIENTES -->
  <div class="section">
    <h2>Clientes</h2>
    <input id="erpClientName" placeholder="Nombre">
    <input id="erpClientEmail" placeholder="Email">
    <input id="erpClientRUC" placeholder="RUC">
    <input id="erpClientAddress" placeholder="Direcci√≥n">
    <button id="btnCreateClient" class="btn">Crear Cliente</button>
    <table id="erpClientsTable">
      <thead><tr><th>Nombre</th><th>Email</th><th>RUC</th><th>Direcci√≥n</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- PRODUCTOS -->
  <div class="section">
    <h2>Productos</h2>
    <input id="erpProductName" placeholder="Nombre">
    <input id="erpProductPrice" type="number" placeholder="Precio">
    <input id="erpProductStock" type="number" placeholder="Stock">
    <label><input type="checkbox" id="erpProductIva"> Aplica IVA</label>
    <button id="btnCreateProduct" class="btn">Crear Producto</button>
    <table id="erpProductsTable">
      <thead><tr><th>Nombre</th><th>Precio</th><th>Stock</th><th>IVA</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- COTIZACI√ìN -->
  <div class="section">
    <h2>Cotizaci√≥n</h2>
    <select id="cartClientSelect"></select>
    <select id="cartProductSelect"></select>
    <input id="cartQty" type="number" placeholder="Cantidad" value="1" min="1">
    <button id="btnAddToCart" class="btn-secondary">Agregar al Carrito</button>
    <table id="cartTable">
      <thead><tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Total</th><th></th></tr></thead>
      <tbody></tbody>
    </table>
    <p id="cartTotal"></p>
    <button id="btnCreateQuote" class="btn">Guardar Cotizaci√≥n</button>
  </div>

  <div class="section">
    <h2>Cotizaciones Guardadas</h2>
    <table id="erpQuotesTable">
      <thead><tr><th>ID</th><th>Cliente</th><th>Productos</th><th>Total</th><th>Acciones</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Facturas</h2>
    <table id="erpInvoicesTable">
      <thead><tr><th>ID</th><th>Cliente</th><th>Subtotal</th><th>IVA</th><th>Total</th><th>Acciones</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script type="module">
  // 1Ô∏è‚É£ Importar Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import { 
    getFirestore, collection, addDoc, doc, getDocs, onSnapshot, deleteDoc 
  } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

  // 2Ô∏è‚É£ Configuraci√≥n Firebase
  const firebaseConfig = {
    // ‚¨ÖÔ∏è PEGA TU CONFIG AQU√ç
  };// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBlBADgWHHgXtitHMpEQMDfPuNKQTx0xyo",
  authDomain: "facti-8a490.firebaseapp.com",
  projectId: "facti-8a490",
  storageBucket: "facti-8a490.firebasestorage.app",
  messagingSenderId: "1082380785603",
  appId: "1:1082380785603:web:7e95cb76b75d28669e0f76"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 3Ô∏è‚É£ Variables globales
  let clients = [], products = [], quotes = [], invoices = [], cart = [];

  // 4Ô∏è‚É£ Escuchar cambios
  onSnapshot(collection(db, "clients"), (snap) => {
    clients = snap.docs.map(d => ({ id:d.id, ...d.data() }));
    renderClients();
  });

  onSnapshot(collection(db, "products"), (snap) => {
    products = snap.docs.map(d => ({ id:d.id, ...d.data() }));
    renderProducts();
  });

  onSnapshot(collection(db, "quotes"), (snap) => {
    quotes = snap.docs.map(d => ({ id:d.id, ...d.data() }));
    renderQuotes();
  });

  onSnapshot(collection(db, "invoices"), (snap) => {
    invoices = snap.docs.map(d => ({ id:d.id, ...d.data() }));
    renderInvoices();
  });

  // 5Ô∏è‚É£ Crear Cliente
  async function createClientERP(){
    const name = document.getElementById("erpClientName").value.trim();
    const email = document.getElementById("erpClientEmail").value.trim();
    const ruc = document.getElementById("erpClientRUC").value.trim();
    const address = document.getElementById("erpClientAddress").value.trim();
    if(!name) return alert("Nombre requerido");
    await addDoc(collection(db,"clients"), { name,email,ruc,address });
    document.getElementById("erpClientName").value="";
    document.getElementById("erpClientEmail").value="";
    document.getElementById("erpClientRUC").value="";
    document.getElementById("erpClientAddress").value="";
  }

  // 6Ô∏è‚É£ Crear Producto
  async function createProductERP(){
    const name=document.getElementById("erpProductName").value.trim();
    const price=parseFloat(document.getElementById("erpProductPrice").value);
    const stock=parseInt(document.getElementById("erpProductStock").value);
    const applyIva=document.getElementById("erpProductIva").checked;
    if(!name||isNaN(price)) return alert("Datos inv√°lidos");
    await addDoc(collection(db,"products"), {name,price,stock,applyIva});
    document.getElementById("erpProductName").value="";
    document.getElementById("erpProductPrice").value="";
    document.getElementById("erpProductStock").value="";
    document.getElementById("erpProductIva").checked=false;
  }

  // 7Ô∏è‚É£ Carrito
  function addToCart(){
    const prodId = document.getElementById("cartProductSelect").value;
    const qty = parseInt(document.getElementById("cartQty").value);
    const p = products.find(x=>x.id===prodId);
    if(!p) return;
    cart.push({...p, qty});
    renderCart();
  }
  function removeCartItem(i){ cart.splice(i,1); renderCart(); }
  function renderCart(){
    const tbody = document.querySelector("#cartTable tbody");
    tbody.innerHTML="";
    let subtotal=0, subtotalIva=0;
    cart.forEach((it,i)=>{
      const line = it.price*it.qty;
      subtotal+=line;
      if(it.applyIva) subtotalIva+=line;
      tbody.innerHTML += `<tr>
        <td>${it.name}</td><td>${it.qty}</td><td>${it.price}</td><td>${line.toFixed(2)}</td>
        <td><button class='btn-danger' onclick='removeCartItem(${i})'>X</button></td></tr>`;
    });
    const iva = subtotalIva*0.15;
    const total = subtotal+iva;
    document.getElementById("cartTotal").innerText = `Subtotal: $${subtotal.toFixed(2)} | IVA: $${iva.toFixed(2)} | Total: $${total.toFixed(2)}`;
  }

  // 8Ô∏è‚É£ Cotizaci√≥n
  async function createCartQuote(){
    if(!cart.length) return alert("Carrito vac√≠o");
    const clientId = document.getElementById("cartClientSelect").value;
    let subtotal=0, subtotalIva=0;
    cart.forEach(it=>{const l=it.price*it.qty; subtotal+=l; if(it.applyIva) subtotalIva+=l;});
    const iva = subtotalIva*0.15; const total = subtotal+iva;
    await addDoc(collection(db,"quotes"), {clientId, items:cart, subtotal, iva, total});
    cart=[]; renderCart();
  }

  // 9Ô∏è‚É£ Facturar
  async function convertToInvoice(id){
    const q = quotes.find(x=>x.id===id);
    if(!q) return;
    await addDoc(collection(db,"invoices"), {...q, date:new Date().toLocaleString()});
    await deleteDoc(doc(db,"quotes",id));
  }

  // üîü Renderizadores
  function renderClients(){
    const tbody=document.querySelector("#erpClientsTable tbody");
    tbody.innerHTML="";
    clients.forEach(c=>{
      tbody.innerHTML+=`<tr><td>${c.name}</td><td>${c.email||""}</td><td>${c.ruc||""}</td><td>${c.address||""}</td></tr>`;
    });
    const sel=document.getElementById("cartClientSelect");
    sel.innerHTML = clients.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
  }
  function renderProducts(){
    const tbody=document.querySelector("#erpProductsTable tbody");
    tbody.innerHTML="";
    products.forEach(p=>{
      tbody.innerHTML+=`<tr><td>${p.name}</td><td>${p.price}</td><td>${p.stock}</td><td>${p.applyIva?"S√≠":"No"}</td></tr>`;
    });
    const sel=document.getElementById("cartProductSelect");
    sel.innerHTML = products.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
  }
  function renderQuotes(){
    const tbody=document.querySelector("#erpQuotesTable tbody");
    tbody.innerHTML="";
    quotes.forEach(q=>{
      const client = clients.find(c=>c.id===q.clientId);
      tbody.innerHTML+=`<tr>
        <td>${q.id}</td><td>${client?client.name:"?"}</td>
        <td>${q.items.map(it=>it.name+"("+it.qty+")").join(", ")}</td>
        <td>${q.total.toFixed(2)}</td>
        <td><button class='btn-secondary' onclick='convertToInvoice("${q.id}")'>Facturar</button></td></tr>`;
    });
  }
  function renderInvoices(){
    const tbody=document.querySelector("#erpInvoicesTable tbody");
    tbody.innerHTML="";
    invoices.forEach(inv=>{
      const client = clients.find(c=>c.id===inv.clientId);
      tbody.innerHTML+=`<tr><td>${inv.id}</td><td>${client?client.name:"?"}</td>
      <td>${inv.subtotal.toFixed(2)}</td><td>${inv.iva.toFixed(2)}</td><td>${inv.total.toFixed(2)}</td></tr>`;
    });
  }

  // üß† Eventos
  window.addToCart = addToCart;
  window.removeCartItem = removeCartItem;
  window.convertToInvoice = convertToInvoice;

  document.getElementById("btnCreateClient").addEventListener("click", createClientERP);
  document.getElementById("btnCreateProduct").addEventListener("click", createProductERP);
  document.getElementById("btnAddToCart").addEventListener("click", addToCart);
  document.getElementById("btnCreateQuote").addEventListener("click", createCartQuote);

</script>
</body>
</html>









