<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mini ERP con IVA y Facturas Bonitas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { background:#1976d2; color:white; padding:6px; border-radius:6px; }
    table { border-collapse: collapse; width: 100%; margin-top:10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
    input, select, button { margin: 4px; padding: 6px; }
    button { background:#1976d2; color:white; border:none; border-radius:4px; cursor:pointer; }
    button:hover { background:#1565c0; }
    .container { display: grid; grid-template-columns: repeat(2,1fr); gap: 20px; }
    .section { border:1px solid #ddd; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
<h1>Mini ERP - Gestión Clientes, Productos, Facturas</h1>
<div class="container">

  <!-- CLIENTES -->
  <div class="section">
    <h2>Clientes</h2>
    <input type="text" id="erpClientName" placeholder="Nombre">
    <input type="text" id="erpClientRuc" placeholder="RUC">
    <button id="btnCreateClient">Crear Cliente</button>
    <table id="clientsTable"><thead><tr><th>ID</th><th>Nombre</th><th>RUC</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- PRODUCTOS -->
  <div class="section">
    <h2>Productos</h2>
    <input type="text" id="erpProductName" placeholder="Producto">
    <input type="number" id="erpProductPrice" placeholder="Precio" step="0.01">
    <input type="number" id="erpProductStock" placeholder="Stock">
    <label><input type="checkbox" id="erpProductIva"> Aplica IVA</label>
    <button id="btnCreateProduct">Crear Producto</button>
    <table id="productsTable"><thead><tr><th>ID</th><th>Producto</th><th>Precio</th><th>Stock</th><th>IVA</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- CARRITO -->
  <div class="section">
    <h2>Carrito</h2>
    <select id="cartClient"></select>
    <select id="cartProduct"></select>
    <input type="number" id="cartQty" placeholder="Cantidad" min="1">
    <button id="btnAddToCart">Agregar</button>
    <table id="cartTable"><thead><tr><th>Producto</th><th>Cant</th><th>Precio</th><th>Total</th></tr></thead><tbody></tbody></table>
    <button id="btnCreateQuote">Generar Cotización</button>
  </div>

  <!-- FACTURAS -->
  <div class="section">
    <h2>Facturas</h2>
    <table id="invoicesTable"><thead><tr><th>ID</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Acción</th></tr></thead><tbody></tbody></table>
  </div>

</div>

<script>
// === DATA ===
let clients = [], products = [], cart = [], invoices = [];
let nextId = 1;

// === RENDER CLIENTES ===
function renderClients(){
  const tb=document.querySelector("#clientsTable tbody");
  tb.innerHTML=clients.map(c=>`<tr><td>${c.id}</td><td>${c.name}</td><td>${c.ruc}</td></tr>`).join("");
  const sel=document.getElementById("cartClient");
  sel.innerHTML=clients.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
}

// === RENDER PRODUCTOS ===
function renderProducts(){
  const tb=document.querySelector("#productsTable tbody");
  tb.innerHTML=products.map(p=>`<tr><td>${p.id}</td><td>${p.name}</td><td>${p.price.toFixed(2)}</td><td>${p.stock}</td><td>${p.applyIva?"Sí":"No"}</td></tr>`).join("");
  const sel=document.getElementById("cartProduct");
  sel.innerHTML=products.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
}

// === RENDER CARRITO ===
function renderCart(){
  const tb=document.querySelector("#cartTable tbody");
  tb.innerHTML=cart.map(it=>`<tr><td>${it.name}</td><td>${it.qty}</td><td>${it.price.toFixed(2)}</td><td>${(it.qty*it.price).toFixed(2)}</td></tr>`).join("");
}

// === RENDER FACTURAS ===
function renderInvoices(){
  const tb=document.querySelector("#invoicesTable tbody");
  tb.innerHTML=invoices.map(inv=>{
    const c=clients.find(x=>x.id===inv.clientId);
    return `<tr>
      <td>${inv.id}</td>
      <td>${c?c.name:""}</td>
      <td>${inv.date}</td>
      <td>${inv.total.toFixed(2)}</td>
      <td><button onclick="downloadInvoicePDF(${inv.id})">PDF</button></td>
    </tr>`;
  }).join("");
}

// === CRUD CLIENTES ===
function createClientERP(){
  const name=document.getElementById("erpClientName").value.trim();
  const ruc=document.getElementById("erpClientRuc").value.trim();
  if(!name||!ruc) return alert("Datos incompletos");
  clients.push({id:nextId++,name,ruc});
  document.getElementById("erpClientName").value="";
  document.getElementById("erpClientRuc").value="";
  renderClients();
}

// === CRUD PRODUCTOS ===
function createProductERP(){
  const name=document.getElementById("erpProductName").value.trim();
  const price=parseFloat(document.getElementById("erpProductPrice").value);
  const stock=parseInt(document.getElementById("erpProductStock").value);
  const applyIva=document.getElementById("erpProductIva").checked;
  if(!name||isNaN(price)||isNaN(stock)) return alert("Datos incompletos");
  products.push({id:nextId++,name,price,stock,applyIva});
  document.getElementById("erpProductName").value="";
  document.getElementById("erpProductPrice").value="";
  document.getElementById("erpProductStock").value="";
  document.getElementById("erpProductIva").checked=false;
  renderProducts();
}

// === CARRITO ===
function addToCart(){
  const prodId=parseInt(document.getElementById("cartProduct").value);
  const qty=parseInt(document.getElementById("cartQty").value);
  const prod=products.find(p=>p.id===prodId);
  if(!prod||isNaN(qty)||qty<=0) return alert("Datos inválidos");
  if(qty>prod.stock) return alert("No hay suficiente stock");
  cart.push({productId:prod.id,name:prod.name,price:prod.price,qty,applyIva:prod.applyIva});
  renderCart();
}

// === COTIZACIÓN/FACTURA ===
function createCartQuote(){
  if(!cart.length) return alert("Carrito vacío");
  const clientId=parseInt(document.getElementById("cartClient").value);
  const date=new Date().toLocaleDateString();

  let subtotal=0, subtotalIva=0;
  cart.forEach(it=>{
    const lineTotal=it.qty*it.price;
    subtotal+=lineTotal;
    if(it.applyIva) subtotalIva+=lineTotal;
    const prod=products.find(p=>p.id===it.productId);
    if(prod) prod.stock-=it.qty;
  });

  const iva=subtotalIva*0.15;
  const total=subtotal+iva;

  const inv={id:nextId++,clientId,date,items:[...cart],subtotal,iva,total};
  invoices.push(inv);
  cart=[];
  renderCart(); renderProducts(); renderInvoices();
}

// === PDF FACTURA BONITA ===
function downloadInvoicePDF(id){
  const inv=invoices.find(i=>i.id===id);
  if(!inv) return;
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();

  // ENCABEZADO
  doc.setFillColor(25,118,210);
  doc.rect(0,0,210,30,"F");
  doc.setTextColor(255,255,255);
  doc.setFontSize(18);
  doc.text("FACTURA",105,20,{align:"center"});

  // Empresa
  doc.setTextColor(0,0,0);
  doc.setFontSize(10);
  doc.text("Mi Empresa S.A.",20,40);
  doc.text("RUC: 9999999999",20,46);
  doc.text("Dirección: Quito - Ecuador",20,52);

  // Cliente
  const client=clients.find(c=>c.id===inv.clientId);
  doc.setFillColor(240,240,240);
  doc.rect(20,60,170,25,"F");
  doc.setFontSize(11);
  doc.text(`Cliente: ${client?client.name:""}`,25,70);
  doc.text(`RUC: ${client?client.ruc:""}`,25,76);
  doc.text(`Fecha: ${inv.date}`,25,82);

  // TABLA
  let y=100;
  doc.setFontSize(11);
  doc.setFillColor(200,200,200);
  doc.rect(20,y,170,8,"F");
  doc.text("Producto",25,y+6);
  doc.text("Cant.",110,y+6);
  doc.text("Precio",140,y+6);
  doc.text("Total",180,y+6,{align:"right"});
  y+=14;

  inv.items.forEach((it,index)=>{
    if(index%2==0){ doc.setFillColor(245,245,245); doc.rect(20,y-6,170,8,"F"); }
    doc.text(it.name,25,y);
    doc.text(String(it.qty),112,y);
    doc.text(it.price.toFixed(2),142,y);
    doc.text((it.qty*it.price).toFixed(2),180,y,{align:"right"});
    y+=10;
  });

  // TOTALES
  y+=10;
  doc.setFontSize(11);
  doc.text(`Subtotal: $${inv.subtotal.toFixed(2)}`,180,y,{align:"right"});
  y+=8;
  doc.text(`IVA: $${inv.iva.toFixed(2)}`,180,y,{align:"right"});
  y+=8;
  doc.setFontSize(13);
  doc.setFillColor(220,220,220);
  doc.rect(130,y-6,60,10,"F");
  doc.text(`TOTAL: $${inv.total.toFixed(2)}`,180,y,{align:"right"});

  // PIE
  doc.setFontSize(10);
  doc.setTextColor(100,100,100);
  doc.text("Gracias por su compra",105,290,{align:"center"});

  doc.save(`Factura_${inv.id}.pdf`);
}

// === EVENTOS ===
document.getElementById("btnCreateClient").addEventListener("click",createClientERP);
document.getElementById("btnCreateProduct").addEventListener("click",createProductERP);
document.getElementById("btnAddToCart").addEventListener("click",addToCart);
document.getElementById("btnCreateQuote").addEventListener("click",createCartQuote);

// === INIT ===
renderClients(); renderProducts(); renderInvoices();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mini ERP con IVA, Facturas Bonitas y Eliminación</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { background:#1976d2; color:white; padding:6px; border-radius:6px; }
    table { border-collapse: collapse; width: 100%; margin-top:10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
    input, select, button { margin: 4px; padding: 6px; }
    button { background:#1976d2; color:white; border:none; border-radius:4px; cursor:pointer; }
    button:hover { background:#1565c0; }
    .container { display: grid; grid-template-columns: repeat(2,1fr); gap: 20px; }
    .section { border:1px solid #ddd; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .btn-delete { background:#d32f2f; }
    .btn-delete:hover { background:#b71c1c; }
  </style>
</head>
<body>
<h1>Mini ERP - Gestión Clientes, Productos, Facturas</h1>
<div class="container">

  <!-- CLIENTES -->
  <div class="section">
    <h2>Clientes</h2>
    <input type="text" id="erpClientName" placeholder="Nombre">
    <input type="text" id="erpClientRuc" placeholder="RUC">
    <button id="btnCreateClient">Crear Cliente</button>
    <table id="clientsTable"><thead><tr><th>ID</th><th>Nombre</th><th>RUC</th><th>Acción</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- PRODUCTOS -->
  <div class="section">
    <h2>Productos</h2>
    <input type="text" id="erpProductName" placeholder="Producto">
    <input type="number" id="erpProductPrice" placeholder="Precio" step="0.01">
    <input type="number" id="erpProductStock" placeholder="Stock">
    <label><input type="checkbox" id="erpProductIva"> Aplica IVA</label>
    <button id="btnCreateProduct">Crear Producto</button>
    <table id="productsTable"><thead><tr><th>ID</th><th>Producto</th><th>Precio</th><th>Stock</th><th>IVA</th><th>Acción</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- CARRITO -->
  <div class="section">
    <h2>Carrito</h2>
    <select id="cartClient"></select>
    <select id="cartProduct"></select>
    <input type="number" id="cartQty" placeholder="Cantidad" min="1">
    <button id="btnAddToCart">Agregar</button>
    <table id="cartTable"><thead><tr><th>Producto</th><th>Cant</th><th>Precio</th><th>Total</th></tr></thead><tbody></tbody></table>
    <button id="btnCreateQuote">Generar Cotización</button>
  </div>

  <!-- FACTURAS -->
  <div class="section">
    <h2>Facturas</h2>
    <table id="invoicesTable"><thead><tr><th>ID</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Acción</th></tr></thead><tbody></tbody></table>
  </div>

</div>

<script>
// === DATA ===
let clients = [], products = [], cart = [], invoices = [];
let nextId = 1;

// === RENDER CLIENTES ===
function renderClients(){
  const tb=document.querySelector("#clientsTable tbody");
  tb.innerHTML=clients.map(c=>`<tr>
    <td>${c.id}</td>
    <td>${c.name}</td>
    <td>${c.ruc}</td>
    <td><button class="btn-delete" onclick="deleteClient(${c.id})">Eliminar</button></td>
  </tr>`).join("");
  const sel=document.getElementById("cartClient");
  sel.innerHTML=clients.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
}

// === RENDER PRODUCTOS ===
function renderProducts(){
  const tb=document.querySelector("#productsTable tbody");
  tb.innerHTML=products.map(p=>`<tr>
    <td>${p.id}</td>
    <td>${p.name}</td>
    <td>${p.price.toFixed(2)}</td>
    <td>${p.stock}</td>
    <td>${p.applyIva?"Sí":"No"}</td>
    <td><button class="btn-delete" onclick="deleteProduct(${p.id})">Eliminar</button></td>
  </tr>`).join("");
  const sel=document.getElementById("cartProduct");
  sel.innerHTML=products.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
}

// === RENDER CARRITO ===
function renderCart(){
  const tb=document.querySelector("#cartTable tbody");
  tb.innerHTML=cart.map(it=>`<tr><td>${it.name}</td><td>${it.qty}</td><td>${it.price.toFixed(2)}</td><td>${(it.qty*it.price).toFixed(2)}</td></tr>`).join("");
}

// === RENDER FACTURAS ===
function renderInvoices(){
  const tb=document.querySelector("#invoicesTable tbody");
  tb.innerHTML=invoices.map(inv=>{
    const c=clients.find(x=>x.id===inv.clientId);
    return `<tr>
      <td>${inv.id}</td>
      <td>${c?c.name:""}</td>
      <td>${inv.date}</td>
      <td>${inv.total.toFixed(2)}</td>
      <td>
        <button onclick="downloadInvoicePDF(${inv.id})">PDF</button>
        <button class="btn-delete" onclick="deleteInvoice(${inv.id})">Eliminar</button>
      </td>
    </tr>`;
  }).join("");
}

// === CRUD CLIENTES ===
function createClientERP(){
  const name=document.getElementById("erpClientName").value.trim();
  const ruc=document.getElementById("erpClientRuc").value.trim();
  if(!name||!ruc) return alert("Datos incompletos");
  clients.push({id:nextId++,name,ruc});
  document.getElementById("erpClientName").value="";
  document.getElementById("erpClientRuc").value="";
  renderClients();
}

function deleteClient(id){
  if(invoices.some(inv=>inv.clientId===id)){
    return alert("No se puede eliminar un cliente con facturas asociadas");
  }
  clients = clients.filter(c=>c.id!==id);
  renderClients(); renderInvoices();
}

// === CRUD PRODUCTOS ===
function createProductERP(){
  const name=document.getElementById("erpProductName").value.trim();
  const price=parseFloat(document.getElementById("erpProductPrice").value);
  const stock=parseInt(document.getElementById("erpProductStock").value);
  const applyIva=document.getElementById("erpProductIva").checked;
  if(!name||isNaN(price)||isNaN(stock)) return alert("Datos incompletos");
  products.push({id:nextId++,name,price,stock,applyIva});
  document.getElementById("erpProductName").value="";
  document.getElementById("erpProductPrice").value="";
  document.getElementById("erpProductStock").value="";
  document.getElementById("erpProductIva").checked=false;
  renderProducts();
}

function deleteProduct(id){
  products = products.filter(p=>p.id!==id);
  cart = cart.filter(it=>it.productId!==id); // lo quito del carrito también
  renderProducts(); renderCart();
}

// === CARRITO ===
function addToCart(){
  const prodId=parseInt(document.getElementById("cartProduct").value);
  const qty=parseInt(document.getElementById("cartQty").value);
  const prod=products.find(p=>p.id===prodId);
  if(!prod||isNaN(qty)||qty<=0) return alert("Datos inválidos");
  if(qty>prod.stock) return alert("No hay suficiente stock");
  cart.push({productId:prod.id,name:prod.name,price:prod.price,qty,applyIva:prod.applyIva});
  renderCart();
}

// === COTIZACIÓN/FACTURA ===
function createCartQuote(){
  if(!cart.length) return alert("Carrito vacío");
  const clientId=parseInt(document.getElementById("cartClient").value);
  const date=new Date().toLocaleDateString();

  let subtotal=0, subtotalIva=0;
  cart.forEach(it=>{
    const lineTotal=it.qty*it.price;
    subtotal+=lineTotal;
    if(it.applyIva) subtotalIva+=lineTotal;
    const prod=products.find(p=>p.id===it.productId);
    if(prod) prod.stock-=it.qty;
  });

  const iva=subtotalIva*0.15;
  const total=subtotal+iva;

  const inv={id:nextId++,clientId,date,items:[...cart],subtotal,iva,total};
  invoices.push(inv);
  cart=[];
  renderCart(); renderProducts(); renderInvoices();
}

function deleteInvoice(id){
  invoices = invoices.filter(inv=>inv.id!==id);
  renderInvoices();
}

// === PDF FACTURA BONITA ===
function downloadInvoicePDF(id){
  const inv=invoices.find(i=>i.id===id);
  if(!inv) return;
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();

  // ENCABEZADO
  doc.setFillColor(25,118,210);
  doc.rect(0,0,210,30,"F");
  doc.setTextColor(255,255,255);
  doc.setFontSize(18);
  doc.text("FACTURA",105,20,{align:"center"});

  // Empresa
  doc.setTextColor(0,0,0);
  doc.setFontSize(10);
  doc.text("Mi Empresa S.A.",20,40);
  doc.text("RUC: 9999999999",20,46);
  doc.text("Dirección: Quito - Ecuador",20,52);

  // Cliente
  const client=clients.find(c=>c.id===inv.clientId);
  doc.setFillColor(240,240,240);
  doc.rect(20,60,170,25,"F");
  doc.setFontSize(11);
  doc.text(`Cliente: ${client?client.name:""}`,25,70);
  doc.text(`RUC: ${client?client.ruc:""}`,25,76);
  doc.text(`Fecha: ${inv.date}`,25,82);

  // TABLA
  let y=100;
  doc.setFontSize(11);
  doc.setFillColor(200,200,200);
  doc.rect(20,y,170,8,"F");
  doc.text("Producto",25,y+6);
  doc.text("Cant.",110,y+6);
  doc.text("Precio",140,y+6);
  doc.text("Total",180,y+6,{align:"right"});
  y+=14;

  inv.items.forEach((it,index)=>{
    if(index%2==0){ doc.setFillColor(245,245,245); doc.rect(20,y-6,170,8,"F"); }
    doc.text(it.name,25,y);
    doc.text(String(it.qty),112,y);
    doc.text(it.price.toFixed(2),142,y);
    doc.text((it.qty*it.price).toFixed(2),180,y,{align:"right"});
    y+=10;
  });

  // TOTALES
  y+=10;
  doc.setFontSize(11);
  doc.text(`Subtotal: $${inv.subtotal.toFixed(2)}`,180,y,{align:"right"});
  y+=8;
  doc.text(`IVA: $${inv.iva.toFixed(2)}`,180,y,{align:"right"});
  y+=8;
  doc.setFontSize(13);
  doc.setFillColor(220,220,220);
  doc.rect(130,y-6,60,10,"F");
  doc.text(`TOTAL: $${inv.total.toFixed(2)}`,180,y,{align:"right"});

  // PIE
  doc.setFontSize(10);
  doc.setTextColor(100,100,100);
  doc.text("Gracias por su compra",105,290,{align:"center"});

  doc.save(`Factura_${inv.id}.pdf`);
}

// === EVENTOS ===
document.getElementById("btnCreateClient").addEventListener("click",createClientERP);
document.getElementById("btnCreateProduct").addEventListener("click",createProductERP);
document.getElementById("btnAddToCart").addEventListener("click",addToCart);
document.getElementById("btnCreateQuote").addEventListener("click",createCartQuote);

// === INIT ===
renderClients(); renderProducts(); renderInvoices();
</script>
</body>
</html>





